syntax = "proto3";

package server;

option go_package = "github.com/zhinea/sylix/internal/infra/proto/server";

import "common/validation.proto";

service ServerService {
    rpc Create(Server) returns (ServerResponse);
    rpc Get(Id) returns (ServerResponse);
    rpc All(Empty) returns (ServersResponse);
    rpc Update(Server) returns (ServerResponse);
    rpc Delete(Id) returns (MessageResponse);
    rpc InstallAgent(Id) returns (MessageResponse);
}

enum StatusCode {
    UNSPECIFIED = 0;
    OK = 200;
    CREATED = 201;
    NOT_FOUND = 404;
    INTERNAL_ERROR = 500;
    BAD_REQUEST = 400;
    VALIDATION_FAILED = 402;
}

// Status dimana hanya untuk koneksi ke server, apakah koneksi berhasil atau tidak
enum StatusServer {
    STATUS_SERVER_UNSPECIFIED = 0;
    CONNECTED = 1;
    DISCONNECTED = 2;
}

enum AgentStatusServer {
    AGENT_STATUS_SERVER_UNSPECIFIED = 0;
    INSTALLING = 1;
    CONFIGURING = 2;
    FINALIZING_SETUP = 3;
    SUCCESS = 4;
    FAILED = 5;
}

message Empty {}

message Id {
    string id = 1;
}

message ServerResponse {
    StatusCode status = 1;
    Server server = 2;
    repeated common.ValidationError errors = 3;
    optional string error = 4; 
}

message ServersResponse {
    StatusCode status = 1;
    repeated Server servers = 2;
    repeated common.ValidationError errors = 3;
    optional string error = 4; 
}

message Server {
    string id = 1;
    string name = 2;
    string ipAddress = 3;
    int32 port = 4;
    string protocol = 5;
    ServerCredential credential = 6;
    int32 isRoot = 7;
}

message ServerCredential {
    string username = 1;
    optional string password = 2;
    optional string sshKey = 3;
}

message MessageResponse {
    StatusCode status = 1;
    string message = 2;
}