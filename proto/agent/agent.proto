syntax = "proto3";

package agent;

option go_package = "github.com/zhinea/sylix/internal/infra/proto/agent";

import "common/common.proto";

service Agent {
    rpc GetStatus (GetStatusRequest) returns (GetStatusResponse);
    rpc Heartbeat (HeartbeatRequest) returns (HeartbeatResponse);
    rpc Ping (PingRequest) returns (PingResponse);
    rpc GetConfig (GetConfigRequest) returns (GetConfigResponse);
    
    // Docker Compose Management
    rpc DeployCompose(DeployComposeRequest) returns (common.MessageResponse);
    rpc StopCompose(StopComposeRequest) returns (common.MessageResponse);
    rpc GetComposeStatus(GetComposeStatusRequest) returns (GetComposeStatusResponse);
    rpc GetComposeLogs(GetComposeLogsRequest) returns (stream GetComposeLogsResponse);
}

message GetStatusRequest {}

message GetStatusResponse {
    string status = 1;
    string version = 2;
    int64 uptime = 3;
}

message HeartbeatRequest {
    string agent_id = 1;
    int64 timestamp = 2;
}

message HeartbeatResponse {
    bool acknowledged = 1;
}

message PingRequest {
    int64 timestamp = 1;
}

message PingResponse {
    int64 timestamp = 1;
    string status = 2;
}

message GetConfigRequest {}

message GetConfigResponse {
    string config = 1;
    string timezone = 2;
}

message DeployComposeRequest {
    string project_name = 1;
    string compose_content = 2;
}

message StopComposeRequest {
    string project_name = 1;
}

message GetComposeStatusRequest {
    string project_name = 1;
}

message GetComposeStatusResponse {
    bool running = 1;
    repeated string services = 2;
}

message GetComposeLogsRequest {
    string project_name = 1;
    bool follow = 2;
    int32 tail = 3;
}

message GetComposeLogsResponse {
    string log_line = 1;
}
